{% extends "base.html" %}

{% block head %}
{% endblock %}

{% block body %}
<div class="jumbotron" style="text-align: center; background-color: white;">
  <h1 class="display-4">Mitigation Report</h1>
  <p class="lead">The mitigation report is presented below. You can see the bias mitigation compared to the bias previous value.</p>
  <hr class="my-4">
  <img class="image" src="{{url_for('static', filename='chain_6.png')}}">
  <br>
  <p></p>
  <br>
</div>
{% for element in data %}{{loop.index}}
<div>
  
  <br>
  <br>
  <div class="container">
    {% for el in element['Data'] %}
    <div class="row steps">
      <h4><p></p>Application of <b><i>{{element['Method']|tojson}} </i></b> algorithm</p></h4>
      <div class="col-8">
    <table class="table table-striped ">
      <thead>
        <tr>
          <h3 style="font-family:sans-serif bold">{{el['Metric']|tojson}} </h1>
            {%if el['Metric']=='disparate_impact' %}
              <p>The ideal value of this metric is 1.0</p>
            {% else %}
              <p>The ideal value of this metric is 0.0</p>
            {% endif %}
        </tr>
      </thead>
      <tbody>
        <tr>
          <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.bundle.min.js"></script>
          <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/0.5.7/chartjs-plugin-annotation.min.js"></script>
          <canvas id={{el['ID']|tojson}}  class="rounded float-right"></canvas>
          <script>
            
            var thrsh = {{ threshold| tojson}} / 100;
            var metrics= ["disparate_impact"];
            var given_metric={{ el['Metric']| tojson }};

          if(metrics.includes(given_metric)){
            ymin= thrsh;
            ymax= 2-thrsh;
          }else{
            ymin=1-thrsh;
            ymax=-1+thrsh;
            
          }
            uniqueid={{ loop.index }};
            labels = {{ el['Atts_to_show'] | tojson | safe }}
            values = {{ el['Values'] | tojson }}
            b_values = {{ el['Biased_values'] |tojson }}
            
            var ctx = document.getElementById({{ el['ID']| tojson }});
            var myChart = new Chart(ctx, {
              type: 'bar',
              data: {
                labels: labels,
                datasets: [{
                  label: "Debiased",
              data: values,
              backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
              ],
              borderColor: [
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
              ],
              borderWidth: 1
            },{
                  label: "Biased Value",
              data: b_values,
              backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
              ],
              borderColor: [
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
              ],
              borderWidth: 1
            }]
              },
            options: {
              scales: {
                yAxes: [{
                  id: uniqueid
                }]
              },
              legend: {
                display: false
              },
              annotation: {
                annotations: [{
                  id: 'box1',
                  type: 'box',
                  yScaleID: uniqueid,
                  yMin: ymin,
                  yMax: ymax,
                  label:'fair zone',
                  backgroundColor: 'rgba(100, 100, 100, 0.2)',
                  borderColor: 'rgba(100, 100, 100, 0.2)',
                }]
              }
            }
            });

          </script>
        </tr>
      </tbody> 
    </table>
  </div>
  <div class="col-2">
    {% for el in unbiased_details%}
      {%if el['Method'] == element['Method'] %}
      <ul class="list-group list-group-flush">
        <li class="list-group-item"><b>Fair Model Performance </b></li>
        <li class="list-group-item">Accuracy:{{  "%0.2f"|format(el["Accuracy"]) }}</li>
        <li class="list-group-item">Precision:{{  "%0.2f"|format(el["Precision"]) }}</li>
        <li class="list-group-item">Recall:{{  "%0.2f"|format(el["Recall"]) }}</li>
        <li class="list-group-item">True negatives:{{ el["True negatives"] }}</li>
        <li class="list-group-item">False positives:{{ el["False positives"] }}</li>
        <li class="list-group-item">False negatives:{{ el["False negatives"] }}</li>
        <li class="list-group-item">True positives:{{ el["True positives"] }}</li>
      </ul>
      {%endif%}
    {%endfor%}
  </div>
  <div class="col-2">
    <ul class="list-group list-group-flush">
      <li class="list-group-item"><b>Biased Model Performance </b></li>
      <li class="list-group-item">Accuracy:{{  "%0.2f"|format(biased_details[0]["Accuracy"]) }}</li>
      <li class="list-group-item">Precision:{{ "%0.2f"|format(biased_details[0]["Precision"]) }}</li>
      <li class="list-group-item">Recall:{{ "%0.2f"|format(biased_details[0]["Recall"]) }}</li>
      <li class="list-group-item">True negatives:{{ biased_details[0]["True negatives"] }}</li>
      <li class="list-group-item">False positives:{{ biased_details[0]["False positives"] }}</li>
      <li class="list-group-item">False negatives:{{ biased_details[0]["False negatives"]}}</li>
      <li class="list-group-item">True positives:{{ biased_details[0]["True positives"] }}</li>
    </ul>
  </div>
</div>
    <br>
    <br>
    {%endfor%}
  </div>
</div>
{%endfor%}


{% endblock %}